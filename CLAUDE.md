# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a WordPress plugin collection called "Fair Event Plugins" for event organization with fair pricing models. The main plugin is "Fair Payment" which provides a simple payment block for WordPress.

## Development Commands

### Frontend Development (WordPress Blocks)
```bash
cd fair-payment  # or fair-calendar-button or fair-timetable
npm run start    # Start development server with hot reload
npm run build    # Build production assets for blocks
npm run format   # Format code (ALWAYS run after making changes)
```

### WordPress Development Environment
```bash
docker compose up        # Start WordPress (localhost:8080), MySQL, and phpMyAdmin (localhost:8081)
docker compose --profile cli run wpcli wp --help    # Run WP-CLI commands
```

### PHP Code Quality
```bash
cd fair-payment  # or fair-calendar-button or fair-schedule
composer install         # Install PHP dependencies
vendor/bin/phpcs        # Run PHP code sniffer (if configured)
```

### Code Quality Reminder
**IMPORTANT**: Always run `npm run format` after making any code changes to ensure consistent formatting across the codebase.

## Architecture

### Plugin Structure
- **fair-payment/**: Main WordPress plugin directory
  - **fair-calendar-button.php**: Main plugin file with block registration and initialization
  - **src/blocks/simple-payment/**: WordPress Gutenberg block implementation
    - **index.js**: Block editor JavaScript (React components)
    - **render.php**: Server-side block rendering
    - **style.css**: Block frontend styles
  - **src/admin/**: WordPress admin interface
    - **admin-page.php**: Admin menu and page for plugin settings
  - **build/**: Compiled JavaScript assets (generated by wp-scripts)

### Block Development
- Uses `@wordpress/scripts` for building and development
- Block namespace: `fair-payment/simple-payment-block`
- Attributes: `amount` (string, default "10"), `currency` (string, default "EUR")
- Supports: HTML disabled for security

### PHP Architecture
- Uses PHP 8.0+ with PSR-4 autoloading standards
- Namespace: `FairPayment` with sub-namespaces for components
- WordPress hooks: `init` for block registration, `admin_menu` for admin interface

### Development Environment
- Docker Compose setup with WordPress, MySQL, and phpMyAdmin
- Plugin mounted directly into WordPress plugins directory
- WP-CLI available via Docker profile for WordPress management

## Key Integration Points

- Block registration happens in `fair-calendar-button.php:register_simple_payment_block()`
- Admin page registered via `FairPayment\Admin\register_admin_menu()`
- Frontend rendering handled by `FairPayment\render_simple_payment_block()`
- Block editor scripts built from `src/blocks/simple-payment/index.js` to `build/index.js`

## CSS Classes Documentation

### Dynamic CSS Classes (Added by WordPress/Libraries)
These CSS classes are used even though they may not appear explicitly in our codebase. **Do NOT remove these during CSS cleanup**:

#### WordPress Block Editor Classes
- `wp-block-*` - WordPress automatically generates these for all blocks
- `has-*` - WordPress utility classes added dynamically for colors, spacing, etc.
- `is-*` - WordPress state classes (is-selected, is-focused, etc.)
- `components-*` - WordPress Gutenberg component classes
- `block-editor-*` - WordPress block editor interface classes
- `editor-styles-wrapper` - Gutenberg editor wrapper class
- `is-dragging` - Applied during drag and drop operations

#### Fair Schedule Plugin
- Classes added by WordPress block editor for drag/drop functionality
- Classes generated by WordPress for block wrapper elements
- State classes that may be added by WordPress during editing

#### Fair Calendar Button Plugin  
- Calendar provider classes may be added dynamically by JavaScript
- Event state classes for calendar integration

### CSS Cleanup Guidelines
When reviewing CSS for unused classes:
1. Check this documentation first for dynamic classes
2. Search codebase with: `git grep -r "class-name" --include="*.js" --include="*.php" --include="*.html"`
3. Consider that some classes may be added by third-party libraries or WordPress core
4. When in doubt, keep the class and document it here

## Adding New Plugins to the Monorepo

When creating a new plugin (e.g., `fair-new-plugin`), update these files outside the plugin directory:

### Root package.json
1. **Line ~27**: Add to start script: `& npm run start --workspace=fair-new-plugin`
2. **Line ~30**: Add to format:php script: `fair-new-plugin/src/ fair-new-plugin/__tests__/`
3. **Line ~42**: Add dist-archive script: `"dist-archive:fair-new-plugin": "wp dist-archive fair-new-plugin dist --create-target-dir"`
4. **Lines ~951-957**: Add to workspaces array: `"fair-new-plugin"`

### GitHub CI (.github/workflows/php-ci.yml)
- **Lines ~32-37**: Add vendor cache path: `./fair-new-plugin/vendor`

### Docker Compose (compose.yml)
Add plugin mount to all WordPress services:
- **Line ~14**: Main WordPress: `- ./fair-new-plugin:/var/www/html/wp-content/plugins/fair-new-plugin`
- **Line ~79**: PHP 7.4 service
- **Line ~116**: WP 6.3 service
- **Line ~152**: WP 6.7 service

### Scripts (scripts/sync-wp-versions.js)
**Lines ~20-51**: Add plugin configuration:
```javascript
{
    name: 'fair-new-plugin',
    packagePath: 'fair-new-plugin/package.json',
    phpFiles: ['fair-new-plugin/fair-new-plugin.php'],
    readmeFiles: ['fair-new-plugin/readme.txt'],
}
```
